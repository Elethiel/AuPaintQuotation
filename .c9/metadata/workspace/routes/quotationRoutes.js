{"filter":false,"title":"quotationRoutes.js","tooltip":"/routes/quotationRoutes.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":158,"column":12},"end":{"row":158,"column":13},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":13},"end":{"row":158,"column":14},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":14},"end":{"row":158,"column":15},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":15},"end":{"row":158,"column":16},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":16},"end":{"row":158,"column":17},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":17},"end":{"row":158,"column":18},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":18},"end":{"row":158,"column":19},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":19},"end":{"row":158,"column":20},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":20},"end":{"row":158,"column":21},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":21},"end":{"row":158,"column":22},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":22},"end":{"row":158,"column":23},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":23},"end":{"row":158,"column":24},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":23},"end":{"row":158,"column":24},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":23},"end":{"row":158,"column":24},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":24},"end":{"row":158,"column":25},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":25},"end":{"row":158,"column":26},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":26},"end":{"row":158,"column":27},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":27},"end":{"row":158,"column":28},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":28},"end":{"row":159,"column":0},"action":"insert","lines":["",""]},{"start":{"row":159,"column":0},"end":{"row":159,"column":12},"action":"insert","lines":["            "]}]}],[{"group":"doc","deltas":[{"start":{"row":159,"column":12},"end":{"row":194,"column":5},"action":"insert","lines":["// 1 QUOTATION","    if (quotationObj.quotationType == -1) {","        if (today < quotationObj.quotationCreationDt)                                                       quotationObj.quotationStatus = \"<i>Devis Prévisionnel</i>\"; // not started","        else if (today >= quotationObj.quotationCreationDt && today <= quotationObj.quotationEndValidityDt) quotationObj.quotationStatus = \"Devis en cours\"; // in progress","        else if (today > quotationObj.quotationCreationDt && today > quotationObj.quotationEndValidityDt)   quotationObj.quotationStatus = \"Devis plus valable\"; // no more valable","        else                                                                                                quotationObj.quotationStatus = \"Devis\"; // quotation ?","    } else { // 2 INVOICE","        if (today < quotationObj.quotationCreationDt)                                                       quotationObj.quotationStatus = \"<i>Facture Prévisionnelle</i>\"; // not started","        if (today > quotationObj.quotationCreationDt) {","            var total = 0;","            for(var i = 0; i < quotationObj.quotationPrestaList.length; i++) {","                if (quotationObj.quotationPrestaList[i].productObj) {","                    var subtotal = quotationObj.quotationPrestaList[i].productObj.productTTC * quotationObj.quotationPrestaList[i].prestaQuantity;","                    var discount = (quotationObj.quotationPrestaList[i].prestaDiscount > 0 ? ((100 - quotationObj.quotationPrestaList[i].prestaDiscount ) / 100.0) : 1);","","                    subtotal *= discount;","                    total += subtotal;","                }","            }","            if (quotationObj.quotationGlobalDiscount) total -= quotationObj.quotationGlobalDiscount;","            total = rounded(total);","            var remaining = total;","            if (quotationObj.quotationRealDeposite) remaining -= quotationObj.quotationRealDeposite;","","            for(var i = 0; i < quotationObj.quotationPaymentList.length; i++) {","                remaining = remaining - quotationObj.quotationPaymentList[i].paymentAmount;","            }","            remaining = rounded(remaining);","","            if (total <= 0)                                                                             quotationObj.quotationStatus = \"<i>Facture Vide !</i>\"; // empty !","            else if (remaining > 0)                                                                     quotationObj.quotationStatus = \"Facture en cours\"; // in progress","            else if (remaining == 0)                                                                    quotationObj.quotationStatus = \"<b>Facture Réglée</b>\"; // closed (fully paid)","            else if (remaining < 0)                                                                     quotationObj.quotationStatus = \"<b class='red'>Facture trop perçue !</b>\"; // too much paid !","            else                                                                                        quotationObj.quotationStatus = \"Facture\"; // invoice ?","        }","    }"]}]}],[{"group":"doc","deltas":[{"start":{"row":160,"column":0},"end":{"row":160,"column":4},"action":"insert","lines":["    "]},{"start":{"row":161,"column":0},"end":{"row":161,"column":4},"action":"insert","lines":["    "]},{"start":{"row":162,"column":0},"end":{"row":162,"column":4},"action":"insert","lines":["    "]},{"start":{"row":163,"column":0},"end":{"row":163,"column":4},"action":"insert","lines":["    "]},{"start":{"row":164,"column":0},"end":{"row":164,"column":4},"action":"insert","lines":["    "]},{"start":{"row":165,"column":0},"end":{"row":165,"column":4},"action":"insert","lines":["    "]},{"start":{"row":166,"column":0},"end":{"row":166,"column":4},"action":"insert","lines":["    "]},{"start":{"row":167,"column":0},"end":{"row":167,"column":4},"action":"insert","lines":["    "]},{"start":{"row":168,"column":0},"end":{"row":168,"column":4},"action":"insert","lines":["    "]},{"start":{"row":169,"column":0},"end":{"row":169,"column":4},"action":"insert","lines":["    "]},{"start":{"row":170,"column":0},"end":{"row":170,"column":4},"action":"insert","lines":["    "]},{"start":{"row":171,"column":0},"end":{"row":171,"column":4},"action":"insert","lines":["    "]},{"start":{"row":172,"column":0},"end":{"row":172,"column":4},"action":"insert","lines":["    "]},{"start":{"row":173,"column":0},"end":{"row":173,"column":4},"action":"insert","lines":["    "]},{"start":{"row":174,"column":0},"end":{"row":174,"column":4},"action":"insert","lines":["    "]},{"start":{"row":175,"column":0},"end":{"row":175,"column":4},"action":"insert","lines":["    "]},{"start":{"row":176,"column":0},"end":{"row":176,"column":4},"action":"insert","lines":["    "]},{"start":{"row":177,"column":0},"end":{"row":177,"column":4},"action":"insert","lines":["    "]},{"start":{"row":178,"column":0},"end":{"row":178,"column":4},"action":"insert","lines":["    "]},{"start":{"row":179,"column":0},"end":{"row":179,"column":4},"action":"insert","lines":["    "]},{"start":{"row":180,"column":0},"end":{"row":180,"column":4},"action":"insert","lines":["    "]},{"start":{"row":181,"column":0},"end":{"row":181,"column":4},"action":"insert","lines":["    "]},{"start":{"row":182,"column":0},"end":{"row":182,"column":4},"action":"insert","lines":["    "]},{"start":{"row":183,"column":0},"end":{"row":183,"column":4},"action":"insert","lines":["    "]},{"start":{"row":184,"column":0},"end":{"row":184,"column":4},"action":"insert","lines":["    "]},{"start":{"row":185,"column":0},"end":{"row":185,"column":4},"action":"insert","lines":["    "]},{"start":{"row":186,"column":0},"end":{"row":186,"column":4},"action":"insert","lines":["    "]},{"start":{"row":187,"column":0},"end":{"row":187,"column":4},"action":"insert","lines":["    "]},{"start":{"row":188,"column":0},"end":{"row":188,"column":4},"action":"insert","lines":["    "]},{"start":{"row":189,"column":0},"end":{"row":189,"column":4},"action":"insert","lines":["    "]},{"start":{"row":190,"column":0},"end":{"row":190,"column":4},"action":"insert","lines":["    "]},{"start":{"row":191,"column":0},"end":{"row":191,"column":4},"action":"insert","lines":["    "]},{"start":{"row":192,"column":0},"end":{"row":192,"column":4},"action":"insert","lines":["    "]},{"start":{"row":193,"column":0},"end":{"row":193,"column":4},"action":"insert","lines":["    "]},{"start":{"row":194,"column":0},"end":{"row":194,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":160,"column":0},"end":{"row":160,"column":4},"action":"insert","lines":["    "]},{"start":{"row":161,"column":0},"end":{"row":161,"column":4},"action":"insert","lines":["    "]},{"start":{"row":162,"column":0},"end":{"row":162,"column":4},"action":"insert","lines":["    "]},{"start":{"row":163,"column":0},"end":{"row":163,"column":4},"action":"insert","lines":["    "]},{"start":{"row":164,"column":0},"end":{"row":164,"column":4},"action":"insert","lines":["    "]},{"start":{"row":165,"column":0},"end":{"row":165,"column":4},"action":"insert","lines":["    "]},{"start":{"row":166,"column":0},"end":{"row":166,"column":4},"action":"insert","lines":["    "]},{"start":{"row":167,"column":0},"end":{"row":167,"column":4},"action":"insert","lines":["    "]},{"start":{"row":168,"column":0},"end":{"row":168,"column":4},"action":"insert","lines":["    "]},{"start":{"row":169,"column":0},"end":{"row":169,"column":4},"action":"insert","lines":["    "]},{"start":{"row":170,"column":0},"end":{"row":170,"column":4},"action":"insert","lines":["    "]},{"start":{"row":171,"column":0},"end":{"row":171,"column":4},"action":"insert","lines":["    "]},{"start":{"row":172,"column":0},"end":{"row":172,"column":4},"action":"insert","lines":["    "]},{"start":{"row":173,"column":0},"end":{"row":173,"column":4},"action":"insert","lines":["    "]},{"start":{"row":174,"column":0},"end":{"row":174,"column":4},"action":"insert","lines":["    "]},{"start":{"row":175,"column":0},"end":{"row":175,"column":4},"action":"insert","lines":["    "]},{"start":{"row":176,"column":0},"end":{"row":176,"column":4},"action":"insert","lines":["    "]},{"start":{"row":177,"column":0},"end":{"row":177,"column":4},"action":"insert","lines":["    "]},{"start":{"row":178,"column":0},"end":{"row":178,"column":4},"action":"insert","lines":["    "]},{"start":{"row":179,"column":0},"end":{"row":179,"column":4},"action":"insert","lines":["    "]},{"start":{"row":180,"column":0},"end":{"row":180,"column":4},"action":"insert","lines":["    "]},{"start":{"row":181,"column":0},"end":{"row":181,"column":4},"action":"insert","lines":["    "]},{"start":{"row":182,"column":0},"end":{"row":182,"column":4},"action":"insert","lines":["    "]},{"start":{"row":183,"column":0},"end":{"row":183,"column":4},"action":"insert","lines":["    "]},{"start":{"row":184,"column":0},"end":{"row":184,"column":4},"action":"insert","lines":["    "]},{"start":{"row":185,"column":0},"end":{"row":185,"column":4},"action":"insert","lines":["    "]},{"start":{"row":186,"column":0},"end":{"row":186,"column":4},"action":"insert","lines":["    "]},{"start":{"row":187,"column":0},"end":{"row":187,"column":4},"action":"insert","lines":["    "]},{"start":{"row":188,"column":0},"end":{"row":188,"column":4},"action":"insert","lines":["    "]},{"start":{"row":189,"column":0},"end":{"row":189,"column":4},"action":"insert","lines":["    "]},{"start":{"row":190,"column":0},"end":{"row":190,"column":4},"action":"insert","lines":["    "]},{"start":{"row":191,"column":0},"end":{"row":191,"column":4},"action":"insert","lines":["    "]},{"start":{"row":192,"column":0},"end":{"row":192,"column":4},"action":"insert","lines":["    "]},{"start":{"row":193,"column":0},"end":{"row":193,"column":4},"action":"insert","lines":["    "]},{"start":{"row":194,"column":0},"end":{"row":194,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":160,"column":16},"end":{"row":160,"column":25},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":159,"column":12},"end":{"row":166,"column":16},"action":"remove","lines":["// 1 QUOTATION","            if (req.body.quotationObj.quotationType == -1) {","                if (today < quotationObj.quotationCreationDt)                                                       quotationObj.quotationStatus = \"<i>Devis Prévisionnel</i>\"; // not started","                else if (today >= quotationObj.quotationCreationDt && today <= quotationObj.quotationEndValidityDt) quotationObj.quotationStatus = \"Devis en cours\"; // in progress","                else if (today > quotationObj.quotationCreationDt && today > quotationObj.quotationEndValidityDt)   quotationObj.quotationStatus = \"Devis plus valable\"; // no more valable","                else                                                                                                quotationObj.quotationStatus = \"Devis\"; // quotation ?","            } else { // 2 INVOICE","                "]}]}],[{"group":"doc","deltas":[{"start":{"row":160,"column":0},"end":{"row":160,"column":4},"action":"remove","lines":["    "]},{"start":{"row":161,"column":0},"end":{"row":161,"column":4},"action":"remove","lines":["    "]},{"start":{"row":162,"column":0},"end":{"row":162,"column":4},"action":"remove","lines":["    "]},{"start":{"row":163,"column":0},"end":{"row":163,"column":4},"action":"remove","lines":["    "]},{"start":{"row":164,"column":0},"end":{"row":164,"column":4},"action":"remove","lines":["    "]},{"start":{"row":165,"column":0},"end":{"row":165,"column":4},"action":"remove","lines":["    "]},{"start":{"row":166,"column":0},"end":{"row":166,"column":4},"action":"remove","lines":["    "]},{"start":{"row":167,"column":0},"end":{"row":167,"column":4},"action":"remove","lines":["    "]},{"start":{"row":168,"column":0},"end":{"row":168,"column":4},"action":"remove","lines":["    "]},{"start":{"row":169,"column":0},"end":{"row":169,"column":4},"action":"remove","lines":["    "]},{"start":{"row":170,"column":0},"end":{"row":170,"column":4},"action":"remove","lines":["    "]},{"start":{"row":171,"column":0},"end":{"row":171,"column":4},"action":"remove","lines":["    "]},{"start":{"row":172,"column":0},"end":{"row":172,"column":4},"action":"remove","lines":["    "]},{"start":{"row":173,"column":0},"end":{"row":173,"column":4},"action":"remove","lines":["    "]},{"start":{"row":174,"column":0},"end":{"row":174,"column":4},"action":"remove","lines":["    "]},{"start":{"row":175,"column":0},"end":{"row":175,"column":4},"action":"remove","lines":["    "]},{"start":{"row":176,"column":0},"end":{"row":176,"column":4},"action":"remove","lines":["    "]},{"start":{"row":177,"column":0},"end":{"row":177,"column":4},"action":"remove","lines":["    "]},{"start":{"row":178,"column":0},"end":{"row":178,"column":4},"action":"remove","lines":["    "]},{"start":{"row":179,"column":0},"end":{"row":179,"column":4},"action":"remove","lines":["    "]},{"start":{"row":180,"column":0},"end":{"row":180,"column":4},"action":"remove","lines":["    "]},{"start":{"row":181,"column":0},"end":{"row":181,"column":4},"action":"remove","lines":["    "]},{"start":{"row":182,"column":0},"end":{"row":182,"column":4},"action":"remove","lines":["    "]},{"start":{"row":183,"column":0},"end":{"row":183,"column":4},"action":"remove","lines":["    "]},{"start":{"row":184,"column":0},"end":{"row":184,"column":4},"action":"remove","lines":["    "]},{"start":{"row":185,"column":0},"end":{"row":185,"column":4},"action":"remove","lines":["    "]},{"start":{"row":186,"column":0},"end":{"row":186,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":186,"column":13},"end":{"row":187,"column":13},"action":"remove","lines":["","            }"]}]}],[{"group":"doc","deltas":[{"start":{"row":158,"column":28},"end":{"row":159,"column":0},"action":"insert","lines":["",""]},{"start":{"row":159,"column":0},"end":{"row":159,"column":12},"action":"insert","lines":["            "]}]}],[{"group":"doc","deltas":[{"start":{"row":159,"column":12},"end":{"row":162,"column":24},"action":"insert","lines":[" var today = new Date();","    today.setHours(12);","    today.setMinutes(0);","    today.setSeconds(0);"]}]}],[{"group":"doc","deltas":[{"start":{"row":160,"column":0},"end":{"row":160,"column":4},"action":"insert","lines":["    "]},{"start":{"row":161,"column":0},"end":{"row":161,"column":4},"action":"insert","lines":["    "]},{"start":{"row":162,"column":0},"end":{"row":162,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":160,"column":0},"end":{"row":160,"column":4},"action":"insert","lines":["    "]},{"start":{"row":161,"column":0},"end":{"row":161,"column":4},"action":"insert","lines":["    "]},{"start":{"row":162,"column":0},"end":{"row":162,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":159,"column":12},"end":{"row":159,"column":13},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":163,"column":58},"end":{"row":163,"column":111},"action":"remove","lines":["                                                     "]}]}],[{"group":"doc","deltas":[{"start":{"row":163,"column":58},"end":{"row":163,"column":59},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":163,"column":24},"end":{"row":163,"column":33},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":163,"column":67},"end":{"row":163,"column":76},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":164,"column":24},"end":{"row":164,"column":33},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":166,"column":35},"end":{"row":166,"column":44},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":167,"column":24},"end":{"row":167,"column":33},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":168,"column":39},"end":{"row":168,"column":48},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":168,"column":108},"end":{"row":168,"column":117},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":169,"column":40},"end":{"row":169,"column":49},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":169,"column":114},"end":{"row":169,"column":123},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":175,"column":20},"end":{"row":175,"column":29},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":175,"column":76},"end":{"row":175,"column":85},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":178,"column":20},"end":{"row":178,"column":29},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":178,"column":78},"end":{"row":178,"column":87},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":180,"column":35},"end":{"row":180,"column":44},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":181,"column":44},"end":{"row":181,"column":53},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":185,"column":108},"end":{"row":185,"column":117},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":186,"column":108},"end":{"row":186,"column":117},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":187,"column":108},"end":{"row":187,"column":117},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":188,"column":108},"end":{"row":188,"column":117},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":108},"end":{"row":189,"column":117},"action":"insert","lines":["req.body."]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":159},"end":{"row":189,"column":160},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":160},"end":{"row":189,"column":164},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":164},"end":{"row":189,"column":168},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":168},"end":{"row":189,"column":172},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":172},"end":{"row":189,"column":176},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":176},"end":{"row":189,"column":180},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":180},"end":{"row":189,"column":184},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":184},"end":{"row":189,"column":188},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":189,"column":188},"end":{"row":189,"column":192},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":187,"column":173},"end":{"row":187,"column":176},"action":"insert","lines":["   "]}]}],[{"group":"doc","deltas":[{"start":{"row":187,"column":176},"end":{"row":187,"column":180},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":187,"column":180},"end":{"row":187,"column":184},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":187,"column":184},"end":{"row":187,"column":188},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":187,"column":188},"end":{"row":187,"column":192},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":186,"column":168},"end":{"row":186,"column":172},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":186,"column":172},"end":{"row":186,"column":176},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":186,"column":176},"end":{"row":186,"column":180},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":186,"column":180},"end":{"row":186,"column":184},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":186,"column":184},"end":{"row":186,"column":188},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":186,"column":188},"end":{"row":186,"column":192},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":185,"column":173},"end":{"row":185,"column":176},"action":"insert","lines":["   "]}]}],[{"group":"doc","deltas":[{"start":{"row":185,"column":176},"end":{"row":185,"column":180},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":185,"column":180},"end":{"row":185,"column":184},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":185,"column":184},"end":{"row":185,"column":188},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":185,"column":188},"end":{"row":185,"column":192},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":170,"column":0},"end":{"row":170,"column":4},"action":"remove","lines":["    "]},{"start":{"row":179,"column":0},"end":{"row":179,"column":4},"action":"remove","lines":["    "]},{"start":{"row":184,"column":0},"end":{"row":184,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":164,"column":23},"end":{"row":164,"column":24},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":159,"column":12},"end":{"row":186,"column":108},"action":"remove","lines":["var today = new Date();","            today.setHours(12);","            today.setMinutes(0);","            today.setSeconds(0);","            if (today < req.body.quotationObj.quotationCreationDt) req.body.quotationObj.quotationStatus = \"<i>Facture Prévisionnelle</i>\"; // not started","            if (today >= req.body.quotationObj.quotationCreationDt) {","                var total = 0;","                for(var i = 0; i < req.body.quotationObj.quotationPrestaList.length; i++) {","                    if (req.body.quotationObj.quotationPrestaList[i].productObj) {","                        var subtotal = req.body.quotationObj.quotationPrestaList[i].productObj.productTTC * req.body.quotationObj.quotationPrestaList[i].prestaQuantity;","                        var discount = (req.body.quotationObj.quotationPrestaList[i].prestaDiscount > 0 ? ((100 - req.body.quotationObj.quotationPrestaList[i].prestaDiscount ) / 100.0) : 1);","","                        subtotal *= discount;","                        total += subtotal;","                    }","                }","                if (req.body.quotationObj.quotationGlobalDiscount) total -= req.body.quotationObj.quotationGlobalDiscount;","                total = rounded(total);","                var remaining = total;","                if (req.body.quotationObj.quotationRealDeposite) remaining -= req.body.quotationObj.quotationRealDeposite;","","                for(var i = 0; i < req.body.quotationObj.quotationPaymentList.length; i++) {","                    remaining = remaining - req.body.quotationObj.quotationPaymentList[i].paymentAmount;","                }","                remaining = rounded(remaining);","","                if (total <= 0)                                                                             req.body.quotationObj.quotationStatus = \"<i>Facture Vide !</i>\";                    // empty !","                else if (remaining > 0)                                                                     "]}]}],[{"group":"doc","deltas":[{"start":{"row":159,"column":110},"end":{"row":163,"column":13},"action":"remove","lines":["","                else if (remaining == 0)                                                                    req.body.quotationObj.quotationStatus = \"<b>Facture Réglée</b>\";                    // closed (fully paid)","                else if (remaining < 0)                                                                     req.body.quotationObj.quotationStatus = \"<b class='red'>Facture trop perçue !</b>\"; // too much paid !","                else                                                                                        req.body.quotationObj.quotationStatus = \"Facture\";                                  // invoice ?","            }"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":76},"end":{"row":104,"column":80},"action":"remove","lines":["null"]},{"start":{"row":104,"column":76},"end":{"row":104,"column":77},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":77},"end":{"row":104,"column":78},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":78},"end":{"row":104,"column":79},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":79},"end":{"row":104,"column":80},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":80},"end":{"row":104,"column":81},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":81},"end":{"row":104,"column":82},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":81},"end":{"row":104,"column":82},"action":"remove","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":80},"end":{"row":104,"column":81},"action":"remove","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":80},"end":{"row":104,"column":81},"action":"insert","lines":["q"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":81},"end":{"row":104,"column":82},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":82},"end":{"row":104,"column":83},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":83},"end":{"row":104,"column":84},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":84},"end":{"row":104,"column":85},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":85},"end":{"row":104,"column":86},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":86},"end":{"row":104,"column":87},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":87},"end":{"row":104,"column":88},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":88},"end":{"row":104,"column":89},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":89},"end":{"row":104,"column":90},"action":"insert","lines":["I"]}]}],[{"group":"doc","deltas":[{"start":{"row":104,"column":90},"end":{"row":104,"column":91},"action":"insert","lines":["d"]}]}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":1324,"scrollleft":0,"selection":{"start":{"row":104,"column":91},"end":{"row":104,"column":91},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":1797,"mode":"ace/mode/javascript"}},"timestamp":1416983654904,"hash":"f1ce8335921d8ba80825b74a24da6ea80cb10f78"}